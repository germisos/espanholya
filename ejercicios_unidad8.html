<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unidad 8 - Ejercicios</title>
<script src="menu.js" defer></script>

<style>
/* === ESTILO UNIFICADO Y AJUSTADO (Copiado de U7) === */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }

        .lesson-container {
            max-width: 900px;
            margin: 85px auto 40px auto;
            padding: 25px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        /* T√≠tulos */
        h2, h3 {
            color: #007bff;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        /* === BLOQUES DE EJERCICIOS === */
        .exercise-item {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 22px;
            line-height: 1.55;
        }

        /* === PUNTO 1.1: mucho m√°s compacto === */
        .exercise-item.compacto {
            padding: 12px 18px;
        }

        .exercise-item.compacto p,
        .exercise-item.compacto li {
            line-height: 1.2;
            margin-bottom: 3px;
        }

        .exercise-item.compacto form,
        .exercise-item.compacto div {
            margin: 4px 0;
            padding: 0;
        }


        /* === CAMPOS DE RESPUESTA === */
        .exercise-input {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 8px;
            font-size: 15px;
            margin: 0 5px;
            width: 170px;
        }
        .exercise-input-small {
            width: 120px;
        }

        /* === BOTONES === */
        .verify-button,
        .check-button-small {
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 7px 12px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-left: 10px;
        }

        .verify-button:hover,
        .check-button-small:hover {
            background-color: #1e7e34;
        }

        /* === RESULTADOS === */
        .result-box {
            margin-top: 8px;
            padding: 7px 12px;
            border-radius: 5px;
            background-color: #f0f0f0;
            color: #777;
            font-style: italic;
            border: 1px solid #ddd;
            display: inline-block;
            margin-left: 10px;
        }

        .correct-result {
            background-color: #d4edda !important;
            color: #155724 !important;
            font-weight: bold;
        }

        .incorrect-result {
            background-color: #f8d7da !important;
            color: #721c24 !important;
            font-weight: bold;
        }
        
        .question-line {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .question-text {
            flex-grow: 1;
        }
</style>
  </head>
<body>
  
<div class="lesson-container">
    <h2>Unidad 8 ‚Äì Ejercicios</h2>

    <div class="exercise-item compacto">
        <h3>1.1. Pret√©rito Perfecto (Oraciones Completas)</h3>
        <p>Escribe las oraciones seg√∫n el modelo, poniendo los verbos en la forma del pret√©rito perfecto.</p>
        <p>Ejemplo: Ana/estudiar ingl√©s/todos los d√≠as. ‚Üí Ana ha estudiado ingl√©s todos los d√≠as.</p>

        <div class="question-line">
            <div class="question-text">a) Nosotras/viajar a Europa/este a√±o</div>
            <input type="text" class="exercise-input" id="input-1a" placeholder="Escribe aqu√≠">
            <button class="verify-button" onclick="mostrarRespuesta('1a', 'Nosotras hemos viajado a Europa este a√±o.')">Verificar</button>
            <div id="resultado-1a" class="result-box" style="display:none;"></div>
        </div>

        <div class="question-line">
            <div class="question-text">b) Adri√°n/estudiar franc√©s y alem√°n/casi todas las semanas</div>
            <input type="text" class="exercise-input" id="input-1b" placeholder="Escribe aqu√≠">
            <button class="verify-button" onclick="mostrarRespuesta('1b', 'Adri√°n ha estudiado franc√©s y alem√°n casi todas las semanas.')">Verificar</button>
            <div id="resultado-1b" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">c) Ana/ver la nueva pel√≠cula de Almod√≥var/ya</div>
            <input type="text" class="exercise-input" id="input-1c" placeholder="Escribe aqu√≠">
            <button class="verify-button" onclick="mostrarRespuesta('1c', 'Ana ya ha visto la nueva pel√≠cula de Almod√≥var.')">Verificar</button>
            <div id="resultado-1c" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">d) Nosotros/ya/participar del debate sobre el hambre mundial/este a√±o</div>
            <input type="text" class="exercise-input" id="input-1d" placeholder="Escribe aqu√≠">
            <button class="verify-button" onclick="mostrarRespuesta('1d', 'Nosotros ya hemos participado del debate sobre el hambre mundial este a√±o.')">Verificar</button>
            <div id="resultado-1d" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">e) Vosotras/salir con vuestros amigos/durante todo el verano</div>
            <input type="text" class="exercise-input" id="input-1e" placeholder="Escribe aqu√≠">
            <button class="verify-button" onclick="mostrarRespuesta('1e', 'Vosotras hab√©is salido con vuestros amigos durante todo el verano.')">Verificar</button>
            <div id="resultado-1e" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">f) Los ni√±os/jugar al f√∫tbol/siempre</div>
            <input type="text" class="exercise-input" id="input-1f" placeholder="Escribe aqu√≠">
            <button class="verify-button" onclick="mostrarRespuesta('1f', 'Los ni√±os siempre han jugado al f√∫tbol.')">Verificar</button>
            <div id="resultado-1f" class="result-box" style="display:none;"></div>
        </div>
        
    </div>
    <hr>
    
    <div class="exercise-item compacto">
        <h3>1.2. Pret√©rito Perfecto (Participios)</h3>
        <p>Completa con el participio del verbo entre par√©ntesis.</p>
        <p>Ejemplo: Laura ha (estudiar) <span style="font-weight: bold; color: #007bff;">estudiado</span> ingl√©s.</p>
        
        <div class="question-line">
            <div class="question-text">1. Yo he (comer) <input type="text" class="exercise-input-small" id="input-2-1" placeholder="Participio"> con mis amigos en el bar.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-1', 'comido')">Verificar</button>
            <div id="resultado-2-1" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">2. Nosotros hemos (trabajar) <input type="text" class="exercise-input-small" id="input-2-2" placeholder="Participio"> mucho esta semana.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-2', 'trabajado')">Verificar</button>
            <div id="resultado-2-2" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">3. Mi t√≠o ha (salir) <input type="text" class="exercise-input-small" id="input-2-3" placeholder="Participio"> para Cuba.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-3', 'salido')">Verificar</button>
            <div id="resultado-2-3" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line" style="flex-wrap: wrap;">
            <div class="question-text">4. Lola se ha (tomar) <input type="text" class="exercise-input-small" id="input-2-4a" placeholder="Participio 1"> toda la sopa y no ha (dejar) <input type="text" class="exercise-input-small" id="input-2-4b" placeholder="Participio 2"> nada.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-4', ['tomado', 'dejado'], true)">Verificar</button>
            <div id="resultado-2-4" class="result-box" style="display:none; width: 90%;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">5. Los m√∫sicos han (tocar) <input type="text" class="exercise-input-small" id="input-2-5" placeholder="Participio"> la novena sinfon√≠a de Beethoven.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-5', 'tocado')">Verificar</button>
            <div id="resultado-2-5" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">6. ¬øHab√©is (aprender) <input type="text" class="exercise-input-small" id="input-2-6" placeholder="Participio"> los verbos en espa√±ol?</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-6', 'aprendido')">Verificar</button>
            <div id="resultado-2-6" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">7. No hemos (entender) <input type="text" class="exercise-input-small" id="input-2-7" placeholder="Participio"> el ejercicio.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-7', 'entendido')">Verificar</button>
            <div id="resultado-2-7" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">8. Este domingo he (ir) <input type="text" class="exercise-input-small" id="input-2-8" placeholder="Participio"> a la iglesia.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-8', 'ido')">Verificar</button>
            <div id="resultado-2-8" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line">
            <div class="question-text">9. Ha (subir) <input type="text" class="exercise-input-small" id="input-2-9" placeholder="Participio"> al sexto piso por la escalera porque el ascensor estaba estropeado.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-9', 'subido')">Verificar</button>
            <div id="resultado-2-9" class="result-box" style="display:none;"></div>
        </div>
        
        <div class="question-line" style="flex-wrap: wrap;">
            <div class="question-text">10. He (dormir) <input type="text" class="exercise-input-small" id="input-2-10a" placeholder="Participio 1"> como un lir√≥n y he (so√±ar) <input type="text" class="exercise-input-small" id="input-2-10b" placeholder="Participio 2"> que me tocaba la loter√≠a.</div>
            <button class="verify-button check-button-small" onclick="mostrarRespuesta('2-10', ['dormido', 'so√±ado'], true)">Verificar</button>
            <div id="resultado-2-10" class="result-box" style="display:none; width: 90%;"></div>
        </div>

    </div>
<hr>

<div class="exercise-item">
    <h3>1.3. Participios Regulares (Pr√°ctica Oral)</h3>
    <p>Escucha la pronunciaci√≥n del grupo de participios y luego gr√°bate diciendo las palabras. El sistema te dir√° si has pronunciado correctamente.</p>

    <div class="question-line" style="flex-direction: column; align-items: flex-start; margin-bottom: 20px;">
        <h4>Verbos terminados en -AR</h4>
        <p><strong>Participios:</strong> estudiado, viajado</p>
        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
            <button class="check-button-small" onclick="playAudio('assets/audio/unidad8/pp/ar.mp3')">
                üéß O√≠r Audio
            </button>
            <button class="verify-button" id="record-ar" onclick="startRecording('ar')">
                üé§ Grabar (estudiado, viajado)
            </button>
        </div>
        <div id="recording-result-ar" class="result-box" style="margin-top: 10px; display:none;"></div>
        <input type="hidden" id="expected-text-ar" value="estudiado viajado">
    </div>

    <div class="question-line" style="flex-direction: column; align-items: flex-start; margin-bottom: 20px;">
        <h4>Verbos terminados en -ER</h4>
        <p><strong>Participios:</strong> comido, tenido</p>
        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
            <button class="check-button-small" onclick="playAudio('assets/audio/unidad8/pp/er.mp3')">
                üéß O√≠r Audio
            </button>
            <button class="verify-button" id="record-er" onclick="startRecording('er')">
                üé§ Grabar (comido, tenido)
            </button>
        </div>
        <div id="recording-result-er" class="result-box" style="margin-top: 10px; display:none;"></div>
        <input type="hidden" id="expected-text-er" value="comido tenido">
    </div>

    <div class="question-line" style="flex-direction: column; align-items: flex-start; margin-bottom: 20px;">
        <h4>Verbos terminados en -IR</h4>
        <p><strong>Participios:</strong> construido, reducido</p>
        <div style="display: flex; align-items: center; gap: 15px; margin-top: 10px;">
            <button class="check-button-small" onclick="playAudio('assets/audio/unidad8/pp/ir.mp3')">
                üéß O√≠r Audio
            </button>
            <button class="verify-button" id="record-ir" onclick="startRecording('ir')">
                üé§ Grabar (construido, reducido)
            </button>
        </div>
        <div id="recording-result-ir" class="result-box" style="margin-top: 10px; display:none;"></div>
        <input type="hidden" id="expected-text-ir" value="construido reducido">
    </div>

</div>
    <hr>

<div class="exercise-item compacto">
    <h3>1.4. Participios Irregulares</h3>
    <p>Escribe el **participio irregular** que corresponde a cada verbo en infinitivo.</p>
    
    <div class="question-line">
        <div class="question-text">1. Abrir</div>
        <input type="text" class="exercise-input-small" id="input-4-1" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-1', 'abierto')">Verificar</button>
        <div id="resultado-4-1" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">2. Decir</div>
        <input type="text" class="exercise-input-small" id="input-4-2" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-2', 'dicho')">Verificar</button>
        <div id="resultado-4-2" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">3. Escribir</div>
        <input type="text" class="exercise-input-small" id="input-4-3" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-3', 'escrito')">Verificar</button>
        <div id="resultado-4-3" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">4. Hacer</div>
        <input type="text" class="exercise-input-small" id="input-4-4" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-4', 'hecho')">Verificar</button>
        <div id="resultado-4-4" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">5. Resolver</div>
        <input type="text" class="exercise-input-small" id="input-4-5" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-5', 'resuelto')">Verificar</button>
        <div id="resultado-4-5" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">6. Volver</div>
        <input type="text" class="exercise-input-small" id="input-4-6" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-6', 'vuelto')">Verificar</button>
        <div id="resultado-4-6" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">7. Romper</div>
        <input type="text" class="exercise-input-small" id="input-4-7" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-7', 'roto')">Verificar</button>
        <div id="resultado-4-7" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">8. Devolver</div>
        <input type="text" class="exercise-input-small" id="input-4-8" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-8', 'devuelto')">Verificar</button>
        <div id="resultado-4-8" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">9. Imprimir</div>
        <input type="text" class="exercise-input-small" id="input-4-9" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-9', 'impreso')">Verificar</button>
        <div id="resultado-4-9" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">10. Ver</div>
        <input type="text" class="exercise-input-small" id="input-4-10" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-10', 'visto')">Verificar</button>
        <div id="resultado-4-10" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">11. Morir</div>
        <input type="text" class="exercise-input-small" id="input-4-11" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-11', 'muerto')">Verificar</button>
        <div id="resultado-4-11" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">12. Poner</div>
        <input type="text" class="exercise-input-small" id="input-4-12" placeholder="Participio">
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('4-12', 'puesto')">Verificar</button>
        <div id="resultado-4-12" class="result-box" style="display:none;"></div>
    </div>

</div>
        <hr>

<div class="exercise-item">
    <h3>2. Valorar Hechos Pasados</h3>
    <p>Elige la valoraci√≥n m√°s adecuada para cada pregunta, utilizando las estructuras del Pret√©rito Perfecto Compuesto.</p>

    <div class="question-box" id="q5-1">
        <p>1. Pregunta: **"¬øQu√© tal la excursi√≥n de ayer?"**</p>
        <div class="options-container">
            <input type="radio" name="q5-1" id="q5-1-a" value="incorrect">
            <label for="q5-1-a">Hemos viajado a Europa.</label><br>
            <input type="radio" name="q5-1" id="q5-1-b" value="correct">
            <label for="q5-1-b">Ha sido muy agradable.</label><br>
            <input type="radio" name="q5-1" id="q5-1-c" value="incorrect">
            <label for="q5-1-c">Yo estoy fatal.</label><br>
        </div>
        <button class="verify-button check-button-small" onclick="checkMultipleChoice('q5-1')">Verificar</button>
        <div id="resultado-q5-1" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-box" id="q5-2">
        <p>2. Pregunta: **"¬øC√≥mo te ha ido en la reuni√≥n de la ma√±ana?"**</p>
        <div class="options-container">
            <input type="radio" name="q5-2" id="q5-2-a" value="correct">
            <label for="q5-2-a">Ha sido bastante aburrida.</label><br>
            <input type="radio" name="q5-2" id="q5-2-b" value="incorrect">
            <label for="q5-2-b">Yo como mucho.</label><br>
            <input type="radio" name="q5-2" id="q5-2-c" value="incorrect">
            <label for="q5-2-c">Ha roto mi vaso.</label><br>
        </div>
        <button class="verify-button check-button-small" onclick="checkMultipleChoice('q5-2')">Verificar</button>
        <div id="resultado-q5-2" class="result-box" style="display:none;"></div>
    </div>

    <div class="question-box" id="q5-3">
        <p>3. Pregunta: **"¬øQu√© tal tu d√≠a?"**</p>
        <div class="options-container">
            <input type="radio" name="q5-3" id="q5-3-a" value="incorrect">
            <label for="q5-3-a">Lo har√© ma√±ana.</label><br>
            <input type="radio" name="q5-3" id="q5-3-b" value="incorrect">
            <label for="q5-3-b">S√≠, me ha gustado.</label><br>
            <input type="radio" name="q5-3" id="q5-3-c" value="correct">
            <label for="q5-3-c">Ha sido un d√≠a horrible.</label><br>
        </div>
        <button class="verify-button check-button-small" onclick="checkMultipleChoice('q5-3')">Verificar</button>
        <div id="resultado-q5-3" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-box" id="q5-4">
        <p>4. Pregunta: **"¬øC√≥mo estuvo la cena con el equipo?"**</p>
        <div class="options-container">
            <input type="radio" name="q5-4" id="q5-4-a" value="correct">
            <label for="q5-4-a">Ha sido una cena muy interesante.</label><br>
            <input type="radio" name="q5-4" id="q5-4-b" value="incorrect">
            <label for="q5-4-b">Ella ha puesto la mesa.</label><br>
            <input type="radio" name="q5-4" id="q5-4-c" value="incorrect">
            <label for="q5-4-c">Ellos han resuelto el problema.</label><br>
        </div>
        <button class="verify-button check-button-small" onclick="checkMultipleChoice('q5-4')">Verificar</button>
        <div id="resultado-q5-4" class="result-box" style="display:none;"></div>
    </div>
    
    <div class="question-box" id="q5-5">
        <p>5. Pregunta: **"¬øQu√© valoraci√≥n le das al festival de m√∫sica de esta tarde?"**</p>
        <div class="options-container">
            <input type="radio" name="q5-5" id="q5-5-a" value="incorrect">
            <label for="q5-5-a">Ha estado all√≠.</label><br>
            <input type="radio" name="q5-5" id="q5-5-b" value="correct">
            <label for="q5-5-b">Ha sido fant√°stico.</label><br>
            <input type="radio" name="q5-5" id="q5-5-c" value="incorrect">
            <label for="q5-5-c">No ha muerto nadie.</label><br>
        </div>
        <button class="verify-button check-button-small" onclick="checkMultipleChoice('q5-5')">Verificar</button>
        <div id="resultado-q5-5" class="result-box" style="display:none;"></div>
    </div>

</div>
<hr>

<div class="exercise-item compacto">
    <h3>3. El Condicional "Si"</h3>
    <p>Completa las siguientes frases condicionales con la forma verbal correcta del **Presente de Indicativo** o el **Futuro Simple**, seg√∫n corresponda. (Usa la primera persona del singular - Yo).</p>

    <div class="question-line">
        <div class="question-text">1. Si (poder) <input type="text" class="exercise-input-small" id="input-6-1a" placeholder="Presente"> viajar, (visitar) <input type="text" class="exercise-input-small" id="input-6-1b" placeholder="Futuro"> todos los pa√≠ses del mundo.</div>
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('6-1', ['puedo', 'visitar√©'], true)">Verificar</button>
        <div id="resultado-6-1" class="result-box" style="display:none; width: 90%;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">2. Si (estudiar) <input type="text" class="exercise-input-small" id="input-6-2a" placeholder="Presente"> duro, (aprobar) <input type="text" class="exercise-input-small" id="input-6-2b" placeholder="Futuro"> el examen.</div>
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('6-2', ['estudio', 'aprobar√©'], true)">Verificar</button>
        <div id="resultado-6-2" class="result-box" style="display:none; width: 90%;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">3. Si (hacer) <input type="text" class="exercise-input-small" id="input-6-3a" placeholder="Presente"> calor, (ir) <input type="text" class="exercise-input-small" id="input-6-3b" placeholder="Futuro"> a nadar al r√≠o.</div>
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('6-3', ['hace', 'ir√©'], true)">Verificar</button>
        <div id="resultado-6-3" class="result-box" style="display:none; width: 90%;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">4. Si (terminar) <input type="text" class="exercise-input-small" id="input-6-4a" placeholder="Presente"> mi tarea, (poder) <input type="text" class="exercise-input-small" id="input-6-4b" placeholder="Futuro"> salir a jugar con mis amigos.</div>
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('6-4', ['termino', 'podr√©'], true)">Verificar</button>
        <div id="resultado-6-4" class="result-box" style="display:none; width: 90%;"></div>
    </div>
    
    <div class="question-line">
        <div class="question-text">5. Si (necesitar) <input type="text" class="exercise-input-small" id="input-6-5a" placeholder="Presente"> ayuda, no (dudar) <input type="text" class="exercise-input-small" id="input-6-5b" placeholder="Futuro"> en dec√≠rmelo.</div>
        <button class="verify-button check-button-small" onclick="mostrarRespuesta('6-5', ['necesito', 'dudar√©'], true)">Verificar</button>
        <div id="resultado-6-5" class="result-box" style="display:none; width: 90%;"></div>
    </div>
</div>
        
  </div>

<script>
// Funci√≥n gen√©rica para mostrar la respuesta correcta
        function mostrarRespuesta(id, respuestaCorrecta, esDoble = false) {
            const resultBox = document.getElementById('resultado-' + id);
            
            if (esDoble) {
                // Para el caso 4 del Punto 2 (dos verbos)
                resultBox.innerHTML = `<strong>Respuesta:</strong> ${respuestaCorrecta[0]} y ${respuestaCorrecta[1]}`;
            } else {
                resultBox.innerHTML = `<strong>Respuesta:</strong> ${respuestaCorrecta}`;
            }
            
            resultBox.classList.remove('incorrect-result');
            resultBox.classList.add('correct-result');
            resultBox.style.display = 'inline-block';
        }
  // ... (Tu configuraci√≥n inicial de SpeechRecognition y playAudio) ...

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;

    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'es-ES';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
    } else {
        console.warn("‚ùå Web Speech API no soportada en este navegador.");
        alert("Tu navegador no soporta la funci√≥n de reconocimiento de voz necesaria para este ejercicio.");
    }
    
    // ... (Tu funci√≥n playAudio) ...
    function playAudio(src) {
        const audio = new Audio(src);
        audio.play().catch(error => {
            console.error("‚ùå Error de reproducci√≥n de audio. Comprueba la ruta:", src, error);
            alert("No se pudo reproducir el audio. Revisa la consola del navegador (F12) o verifica la ruta.");
        });
    }


    // Variable global para controlar el estado
    let isRecording = false;

    // Funci√≥n auxiliar para resetear el estado del bot√≥n
    function resetRecordingState(id) {
        const recordButton = document.getElementById('record-' + id);
        isRecording = false;
        recordButton.textContent = `üé§ Grabar (${id.toUpperCase()})`;
        recordButton.style.backgroundColor = '#28a745'; // Verde
        recordButton.classList.add('verify-button');
    }


    // Funci√≥n principal para iniciar/detener la grabaci√≥n
    function startRecording(id) {
        if (!recognition) return;

        const recordButton = document.getElementById('record-' + id);
        const resultBox = document.getElementById('recording-result-' + id);
        const expectedText = document.getElementById('expected-text-' + id).value.toLowerCase().trim();

        // **AQU√ç EST√Å LA CORRECCI√ìN:** // Si ya est√° grabando y se vuelve a hacer click, simplemente detenemos la API
        if (isRecording) {
            recognition.stop(); 
            return; // Salimos de la funci√≥n. El onresult manejar√° el resultado.
        }

        // --- INICIO DE GRABACI√ìN ---
        isRecording = true;
        recordButton.textContent = 'üî¥ Grabando... Haz clic para detener';
        recordButton.classList.remove('verify-button');
        recordButton.style.backgroundColor = '#dc3545'; // Rojo

        resultBox.style.display = 'block';
        resultBox.textContent = 'Escuchando... Di los participios.';
        resultBox.className = 'result-box';
        
        // Limpiamos los eventos anteriores para evitar duplicados
        recognition.onresult = null;
        recognition.onspeechend = null;
        recognition.onerror = null;

        recognition.start();

        // 3. Manejar resultado del reconocimiento
        recognition.onresult = (event) => {
            resetRecordingState(id); // Reinicia el bot√≥n
            
            const transcript = event.results[0][0].transcript.toLowerCase().trim();
            console.log('üó£Ô∏è Reconocido:', transcript);
            
            // Normalizaci√≥n simple para la comparaci√≥n
            const cleanTranscript = transcript.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, "").replace(/\s{2,}/g," ");

            // Comparar resultado
            if (cleanTranscript === expectedText) {
                resultBox.textContent = '¬°Bien! ‚úÖ Pronunciaci√≥n correcta.';
                resultBox.className = 'result-box correct-result';
            } else {
                resultBox.textContent = `Prueba de nuevo. ‚ùå Dijiste: "${transcript}".`;
                resultBox.className = 'result-box incorrect-result';
            }
        };

        // 4. Manejar fin de voz o stop
        recognition.onspeechend = () => {
             // Detener la API si la voz se detiene autom√°ticamente, y dejar que onresult maneje la UI
            if (isRecording) { 
                recognition.stop();
            }
        };
        
        // 5. Manejar errores
        recognition.onerror = (event) => {
            resetRecordingState(id); // Reinicia el bot√≥n
            
            if (event.error === 'not-allowed') {
                 resultBox.textContent = '‚ö†Ô∏è Necesitas permitir el acceso al micr√≥fono.';
            } else if (event.error === 'no-speech') {
                 resultBox.textContent = 'No detect√© tu voz. Prueba de nuevo.';
            } else {
                 resultBox.textContent = `Error de reconocimiento: ${event.error}. Prueba de nuevo.`;
            }
            resultBox.className = 'result-box incorrect-result';
        };
    }
        // Aseg√∫rate de que esta funci√≥n est√© definida antes de que se use
    function checkMultipleChoice(questionId) {
        const resultBox = document.getElementById('resultado-' + questionId);
        const selectedOption = document.querySelector('input[name="' + questionId + '"]:checked');
        
        // Muestra el resultado
        resultBox.style.display = 'block';
        
        if (!selectedOption) {
            resultBox.textContent = 'Selecciona una opci√≥n.';
            resultBox.className = 'result-box incorrect-result';
            return;
        }

        if (selectedOption.value === 'correct') {
            resultBox.textContent = '¬°Correcto! ‚úÖ';
            resultBox.className = 'result-box correct-result';
        } else {
            const correctLabel = document.querySelector('input[name="' + questionId + '"][value="correct"]').nextElementSibling.textContent;
            resultBox.textContent = `Prueba de nuevo. ‚ùå La respuesta correcta es: ${correctLabel}`;
            resultBox.className = 'result-box incorrect-result';
        }
    }
</script>

</body>
</html>
