<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ejercicios Unidad 5 ‚Äì Verbos con cambio voc√°lico</title>
<script src="menu.js" defer></script>  
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f9;
        color: #333;
    }

    /* Contenedor principal */
    .lesson-container {
        max-width: 900px;
        margin: 80px auto 25px auto;
        padding: 25px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    }

    h2, h3 {
        color: #007bff;
        border-bottom: 2px solid #007bff;
        padding-bottom: 4px;
        margin-top: 30px;
    }

    /* Lista de conjugaci√≥n */
    .verb-conjugation-list {
        list-style: none;
        padding: 0;
    }

    .verb-conjugation-list li {
        margin: 10px 0;
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 1.1em;
    }

    /* Botones de audio (O√≠r - AZUL) */
    .play-button { 
        border: none;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        color: white;
        font-weight: bold;
        background-color: #007bff; /* Azul */
        font-size: 1em;
        flex-shrink: 0;
    }
    .play-button:hover {
        background-color: #0056b3; 
    }

    /* Bot√≥n de Micr√≥fono (Grabar - VERDE) */
    .mic-button {
        background-color: #28a745; /* Verde */
        border: none;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        color: white;
        font-weight: bold;
        font-size: 1em;
        flex-shrink: 0;
    }
    .mic-button:hover {
        background-color: #218838; 
    }

    /* Retroalimentaci√≥n de voz */
    .feedback {
        font-size: 0.9em;
        margin-left: 6px;
        flex-grow: 1; 
    }

    .feedback.ok {
        color: green;
        font-weight: bold;
    }
    .feedback.retry {
        color: red;
    }
    
    .explanation {
        font-style: italic;
        color: #555;
        margin-bottom: 20px;
    }
</style>
</head>

<body>

<div class="lesson-container">

    <h2>EJERCICIOS ‚Äì VERBOS CON CAMBIO VOC√ÅLICO</h2>

    <p class="explanation">Practica la conjugaci√≥n de los siguientes verbos. Primero, haz clic en **O√≠r** para escuchar la pronunciaci√≥n. Luego, haz clic en **üé§ Grabar** y repite la palabra para verificar tu pronunciaci√≥n.</p>

    <div class="verb-section">
        <h3>Verbo PODER (O ‚Üí UE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) puedo 
                <button class="play-button" data-text="puedo" data-audio="assets/audio/unidad5/poder/puedo.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) puedes 
                <button class="play-button" data-text="puedes" data-audio="assets/audio/unidad5/poder/puedes.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) puede 
                <button class="play-button" data-text="puede" data-audio="assets/audio/unidad5/poder/puede.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) podemos 
                <button class="play-button" data-text="podemos" data-audio="assets/audio/unidad5/poder/podemos.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) pod√©is 
                <button class="play-button" data-text="pod√©is" data-audio="assets/audio/unidad5/poder/podeis.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) pueden 
                <button class="play-button" data-text="pueden" data-audio="assets/audio/unidad5/poder/pueden.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>

    <div class="verb-section">
        <h3>Verbo DORMIR (O ‚Üí UE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) duermo 
                <button class="play-button" data-text="duermo" data-audio="assets/audio/unidad5/dormir/duermo.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) duermes 
                <button class="play-button" data-text="duermes" data-audio="assets/audio/unidad5/dormir/duermes.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) duerme 
                <button class="play-button" data-text="duerme" data-audio="assets/audio/unidad5/dormir/duerme.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) dormimos 
                <button class="play-button" data-text="dormimos" data-audio="assets/audio/unidad5/dormir/dormimos.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) dorm√≠s 
                <button class="play-button" data-text="dorm√≠s" data-audio="assets/audio/unidad5/dormir/dormis.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) duermen 
                <button class="play-button" data-text="duermen" data-audio="assets/audio/unidad5/dormir/duermen.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>

    <div class="verb-section">
        <h3>Verbo CERRAR (E ‚Üí IE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) cierro 
                <button class="play-button" data-text="cierro" data-audio="assets/audio/unidad5/cerrar/cierro.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) cierras 
                <button class="play-button" data-text="cierras" data-audio="assets/audio/unidad5/cerrar/cierras.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) cierra 
                <button class="play-button" data-text="cierra" data-audio="assets/audio/unidad5/cerrar/cierra.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) cerramos 
                <button class="play-button" data-text="cerramos" data-audio="assets/audio/unidad5/cerrar/cerramos.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) cerr√°is 
                <button class="play-button" data-text="cerr√°is" data-audio="assets/audio/unidad5/cerrar/cerrais.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) cierran 
                <button class="play-button" data-text="cierran" data-audio="assets/audio/unidad5/cerrar/cierran.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>
    
    <div class="verb-section">
        <h3>Verbo QUERER (E ‚Üí IE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) quiero 
                <button class="play-button" data-text="quiero" data-audio="assets/audio/unidad5/querer/quiero.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) quieres 
                <button class="play-button" data-text="quieres" data-audio="assets/audio/unidad5/querer/quieres.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) quiere 
                <button class="play-button" data-text="quiere" data-audio="assets/audio/unidad5/querer/quiere.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) queremos 
                <button class="play-button" data-text="queremos" data-audio="assets/audio/unidad5/querer/queremos.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) quer√©is 
                <button class="play-button" data-text="quer√©is" data-audio="assets/audio/unidad5/querer/quereis.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) quieren 
                <button class="play-button" data-text="quieren" data-audio="assets/audio/unidad5/querer/quieren.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>
    
    <div class="verb-section">
        <h3>Verbo PREFERIR (E ‚Üí IE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) prefiero 
                <button class="play-button" data-text="prefiero" data-audio="assets/audio/unidad5/preferir/prefiero.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) prefieres 
                <button class="play-button" data-text="prefieres" data-audio="assets/audio/unidad5/preferir/prefieres.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) prefiere 
                <button class="play-button" data-text="prefiere" data-audio="assets/audio/unidad5/preferir/prefiere.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) preferimos 
                <button class="play-button" data-text="preferimos" data-audio="assets/audio/unidad5/preferir/preferimos.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) prefer√≠s 
                <button class="play-button" data-text="prefer√≠s" data-audio="assets/audio/unidad5/preferir/preferis.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) prefieren 
                <button class="play-button" data-text="prefieren" data-audio="assets/audio/unidad5/preferir/prefieren.mp3">O√≠r</button>
                <button class="mic-button">üé§ Grabar</button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>

</div>

<script>
    // 1. Funci√≥n gen√©rica para reproducir cualquier URL de audio
    function playAudio(src) {
        const audio = new Audio(src);
        audio.play().catch(error => {
            console.error("‚ùå Error de reproducci√≥n de audio. Comprueba la ruta:", src, error);
            alert("No se pudo reproducir el audio. Verifica la ruta del archivo y la consola (F12).");
        });
    }

    // 2. Configuraci√≥n e inicializaci√≥n del Reconocimiento de Voz
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'es-ES'; // Idioma espa√±ol
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    // Listener unificado para todos los botones de audio (O√≠r)
    document.querySelectorAll('.play-button').forEach(btn => {
        const audioSrc = btn.dataset.audio;
        if (audioSrc) {
            btn.addEventListener('click', () => {
                playAudio(audioSrc);
            });
        }
    });

    // Listener para los botones de micr√≥fono (Grabar)
    document.querySelectorAll('.mic-button').forEach(micBtn => {
        micBtn.addEventListener('click', () => {
            const parent = micBtn.closest('li');
            const playBtn = parent.querySelector('.play-button');
            
            // Texto esperado (se obtiene del data-text del bot√≥n O√≠r)
            let expectedText = playBtn ? playBtn.dataset.text : '';
            // Limpieza de texto para una mejor comparaci√≥n
            expectedText = expectedText.toLowerCase().trim().replace(/[¬ø?¬°!.,]/g, ''); 
            
            const feedback = parent.querySelector('.feedback');
            
            if (!expectedText) {
                feedback.textContent = "‚ö†Ô∏è Error: Falta el texto esperado para verificar.";
                feedback.className = "feedback retry";
                return;
            }
            
            feedback.textContent = "üéôÔ∏è Escuchando... Di: " + expectedText;
            feedback.className = "feedback";
            micBtn.disabled = true;

            recognition.start();

            recognition.onresult = (event) => {
                const said = event.results[0][0].transcript.toLowerCase().trim().replace(/[¬ø?¬°!.,]/g, '');
                
                // Verificaci√≥n simple para palabras individuales (conjugaciones)
                const isCorrect = said === expectedText;

                if (isCorrect) {
                    feedback.textContent = "‚úÖ ¬°Correcto! (" + said + ")";
                    feedback.className = "feedback ok";
                } else {
                    feedback.textContent = "üîÅ Incorrecto: Dijiste: '" + said + "'. Intenta de nuevo. (Esperado: '" + expectedText + "')";
                    feedback.className = "feedback retry";
                }
            };
            
            // Al finalizar la escucha, habilita el bot√≥n.
            recognition.onend = () => {
                micBtn.disabled = false;
                if(feedback.textContent.includes('Escuchando')) {
                    // Si termina sin resultado (timeout, no-speech, etc.)
                    feedback.textContent = "‚ö†Ô∏è No se detect√≥ voz. Intenta de nuevo.";
                    feedback.className = "feedback retry";
                }
            };

            recognition.onerror = (event) => {
                let errorMsg = "‚ö†Ô∏è Error al usar el micr√≥fono.";
                if (event.error === 'not-allowed') {
                    errorMsg = "‚ö†Ô∏è Acceso denegado: Debes permitir el uso del micr√≥fono.";
                } else if (event.error === 'no-speech') {
                    errorMsg = "‚ö†Ô∏è No se detect√≥ voz. Intenta de nuevo.";
                }
                feedback.textContent = errorMsg;
                feedback.className = "feedback retry";
                micBtn.disabled = false;
                console.error("Speech Recognition Error:", event.error);
            };
        });
    });
</script>

</body>
</html>
