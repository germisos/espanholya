<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ejercicios Unidad 5 ‚Äì Verbos con cambio voc√°lico</title>
<script src="menu.js" defer></script>  
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f9;
        color: #333;
    }

    /* Contenedor principal */
    .lesson-container {
        max-width: 900px;
        margin: 80px auto 25px auto;
        padding: 25px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0,0,0,0.15);
    }

    h2, h3 {
        color: #007bff;
        border-bottom: 2px solid #007bff;
        padding-bottom: 4px;
        margin-top: 30px;
    }

    /* Lista de conjugaci√≥n */
    .verb-conjugation-list {
        list-style: none;
        padding: 0;
    }

    .verb-conjugation-list li {
        margin: 10px 0;
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 1.1em;
    }

    .explanation {
        font-style: italic;
        color: #555;
        margin-bottom: 20px;
    }

    /* Botones de audio (O√≠r - AZUL) */
    .play-button { 
        border: none;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        color: white;
        font-weight: bold;
        background-color: #007bff; /* Azul */
        font-size: 1em;
        flex-shrink: 0;
    }
    .play-button:hover {
        background-color: #0056b3; 
    }
    .play-button::before {
        content: "üîä";
        margin-right: 5px;
    }

    /* Bot√≥n de Micr√≥fono (Grabar - VERDE) */
    .mic-button {
        background-color: #28a745; /* Verde */
        border: none;
        border-radius: 5px;
        padding: 8px 12px;
        cursor: pointer;
        color: white;
        font-weight: bold;
        font-size: 1em;
        flex-shrink: 0;
    }
    .mic-button:hover {
        background-color: #218838; 
    }
    .mic-button::before {
        content: "üé§";
        margin-right: 5px;
    }

    /* Retroalimentaci√≥n de voz */
    .feedback {
        font-size: 0.9em;
        margin-left: 6px;
        flex-grow: 1; 
    }

    .feedback.ok {
        color: green;
        font-weight: bold;
    }
    .feedback.retry {
        color: red;
    }
</style>
</head>

<body>

<div class="lesson-container">

    <h2>EJERCICIOS ‚Äì VERBOS CON CAMBIO VOC√ÅLICO</h2>

    <p class="explanation">Practica la conjugaci√≥n de los siguientes verbos. Primero, haz clic en el bot√≥n azul (üîä) para escuchar la pronunciaci√≥n. Luego, haz clic en el bot√≥n verde (üé§) y repite la palabra para verificar tu pronunciaci√≥n.</p>

    <div class="verb-section">
        <h3>Verbo PODER (O ‚Üí UE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) puedo 
                <button class="play-button" data-text="puedo" data-audio="assets/audio/unidad5/poder/puedo.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) puedes 
                <button class="play-button" data-text="puedes" data-audio="assets/audio/unidad5/poder/puedes.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) puede 
                <button class="play-button" data-text="puede" data-audio="assets/audio/unidad5/poder/puede.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) podemos 
                <button class="play-button" data-text="podemos" data-audio="assets/audio/unidad5/poder/podemos.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) pod√©is 
                <button class="play-button" data-text="pod√©is" data-audio="assets/audio/unidad5/poder/podeis.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) pueden 
                <button class="play-button" data-text="pueden" data-audio="assets/audio/unidad5/poder/pueden.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>

    <div class="verb-section">
        <h3>Verbo DORMIR (O ‚Üí UE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) duermo 
                <button class="play-button" data-text="duermo" data-audio="assets/audio/unidad5/dormir/duermo.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) duermes 
                <button class="play-button" data-text="duermes" data-audio="assets/audio/unidad5/dormir/duermes.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) duerme 
                <button class="play-button" data-text="duerme" data-audio="assets/audio/unidad5/dormir/duerme.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) dormimos 
                <button class="play-button" data-text="dormimos" data-audio="assets/audio/unidad5/dormir/dormimos.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) dorm√≠s 
                <button class="play-button" data-text="dorm√≠s" data-audio="assets/audio/unidad5/dormir/dormis.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) duermen 
                <button class="play-button" data-text="duermen" data-audio="assets/audio/unidad5/dormir/duermen.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>

    <div class="verb-section">
        <h3>Verbo CERRAR (E ‚Üí IE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) cierro 
                <button class="play-button" data-text="cierro" data-audio="assets/audio/unidad5/cerrar/cierro.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) cierras 
                <button class="play-button" data-text="cierras" data-audio="assets/audio/unidad5/cerrar/cierras.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) cierra 
                <button class="play-button" data-text="cierra" data-audio="assets/audio/unidad5/cerrar/cierra.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) cerramos 
                <button class="play-button" data-text="cerramos" data-audio="assets/audio/unidad5/cerrar/cerramos.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) cerr√°is 
                <button class="play-button" data-text="cerr√°is" data-audio="assets/audio/unidad5/cerrar/cerrais.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) cierran 
                <button class="play-button" data-text="cierran" data-audio="assets/audio/unidad5/cerrar/cierran.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>
    
    <div class="verb-section">
        <h3>Verbo QUERER (E ‚Üí IE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) quiero 
                <button class="play-button" data-text="quiero" data-audio="assets/audio/unidad5/querer/quiero.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) quieres 
                <button class="play-button" data-text="quieres" data-audio="assets/audio/unidad5/querer/quieres.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) quiere 
                <button class="play-button" data-text="quiere" data-audio="assets/audio/unidad5/querer/quiere.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) queremos 
                <button class="play-button" data-text="queremos" data-audio="assets/audio/unidad5/querer/queremos.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) quer√©is 
                <button class="play-button" data-text="quer√©is" data-audio="assets/audio/unidad5/querer/quereis.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) quieren 
                <button class="play-button" data-text="quieren" data-audio="assets/audio/unidad5/querer/quieren.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>
    
    <div class="verb-section">
        <h3>Verbo PREFERIR (E ‚Üí IE)</h3>
        <ul class="verb-conjugation-list">
            <li>(yo) prefiero 
                <button class="play-button" data-text="prefiero" data-audio="assets/audio/unidad5/preferir/prefiero.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(t√∫) prefieres 
                <button class="play-button" data-text="prefieres" data-audio="assets/audio/unidad5/preferir/prefieres.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(√©l, ella, usted) prefiere 
                <button class="play-button" data-text="prefiere" data-audio="assets/audio/unidad5/preferir/prefiere.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(nosotros/as) preferimos 
                <button class="play-button" data-text="preferimos" data-audio="assets/audio/unidad5/preferir/preferimos.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(vosotros/as) prefer√≠s 
                <button class="play-button" data-text="prefer√≠s" data-audio="assets/audio/unidad5/preferir/preferis.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
            <li>(ellos/as, ustedes) prefieren 
                <button class="play-button" data-text="prefieren" data-audio="assets/audio/unidad5/preferir/prefieren.mp3"></button>
                <button class="mic-button"></button>
                <span class="feedback"></span>
            </li>
        </ul>
    </div>

</div>

<script>
    // Configuraci√≥n del Reconocimiento de Voz (WebkitSpeechRecognition)
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'es-ES';
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    // Funci√≥n que reproduce el audio de manera segura
    function playAudio(src) {
        const audio = new Audio(src);
        audio.play().catch(error => {
            console.error("‚ùå Error de reproducci√≥n de audio. Comprueba la ruta:", src, error);
            alert("No se pudo reproducir el audio. Revisa la consola del navegador (F12) o verifica la ruta.");
        });
    }

    // Listener unificado para todos los botones de audio (.play-button)
    document.querySelectorAll('.play-button').forEach(btn => {
        btn.addEventListener('click', () => {
            const audioSrc = btn.dataset.audio;
            if (audioSrc) {
                playAudio(audioSrc);
            } else {
                console.warn("No se encontr√≥ una ruta de audio v√°lida para este bot√≥n.");
            }
        });
    });

    // Listener para los botones de micr√≥fono (usa la l√≥gica de verificaci√≥n que te funciona)
    document.querySelectorAll('.mic-button').forEach(micBtn => {
        micBtn.addEventListener('click', () => {
            const parent = micBtn.closest('li');
            
            // Usa data-text del bot√≥n .play-button asociado
            const playBtn = parent.querySelector('.play-button');
            const expectedText = playBtn ? playBtn.dataset.text.toLowerCase() : ""; // Usamos min√∫sculas
            
            const feedback = parent.querySelector('.feedback');
            
            if (!expectedText) {
                 feedback.textContent = "‚ö†Ô∏è Error: Falta el texto esperado (data-text) en el bot√≥n de audio.";
                 feedback.className = "feedback retry";
                 return;
            }
            
            feedback.textContent = "üéôÔ∏è Escuchando...";
            feedback.className = "feedback";
            micBtn.disabled = true;

            recognition.start();

            recognition.onresult = (event) => {
                const rawSaid = event.results[0][0].transcript;
                const said = rawSaid.toLowerCase(); // Usamos min√∫sculas
                
                // Criterio que te funciona: Si la transcripci√≥n incluye el texto esperado
                if (said.includes(expectedText)) {
                    feedback.textContent = "‚úÖ Bien hecho (" + rawSaid + ")";
                    feedback.className = "feedback ok";
                } else {
                    feedback.textContent = "üîÅ Dijo: '" + rawSaid + "' ‚Äî Intenta de nuevo";
                    feedback.className = "feedback retry";
                }
            };
            
            recognition.onend = () => {
                micBtn.disabled = false; // Habilita el bot√≥n al finalizar
                if(feedback.textContent.includes('Escuchando')) {
                    feedback.textContent = "‚ö†Ô∏è No se detect√≥ voz. Intenta de nuevo.";
                    feedback.className = "feedback retry";
                }
            };

            recognition.onerror = (event) => {
                let errorMsg = "‚ö†Ô∏è Error al usar el micr√≥fono";
                if (event.error === 'not-allowed') {
                    errorMsg = "‚ö†Ô∏è Acceso denegado. Permite el micr√≥fono.";
                } else if (event.error === 'no-speech') {
                    errorMsg = "‚ö†Ô∏è No se detect√≥ voz.";
                }
                feedback.textContent = errorMsg;
                feedback.className = "feedback retry";
                micBtn.disabled = false;
                console.error("Speech Recognition Error:", event.error);
            };
        });
    });
</script>

</body>
</html>
